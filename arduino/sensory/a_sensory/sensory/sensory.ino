//Includes statements

#include <dht.h>
#include <math.h>

////////////////////////////////////////////////////////////////////////////////
/////////////////////// Defining Pins /////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

//Analog Pins
#define dht_apin   A0
#define soilPin    A1
#define light_pin  A2


//Digtal pins
#define soilPower  7

//Misc
dht DHT; 

////////////////////////////////////////////////////////////////////////////////
/////////////////////// Initializing variables ////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int dht_temp = 0, dht_humidity = 0, moisture_val = 0, light = 0;



////////////////////////////////////////////////////////////////////////////////
/////////////////////// Methods ////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int readSoil()
{

  digitalWrite(soilPower, HIGH);//turn D7 "On"
  delay(10);//wait 10 milliseconds 
  moisture_val = analogRead(soilPin);//Read the SIG value form sensor 
  digitalWrite(soilPower, LOW);//turn D7 "Off"
  return moisture_val;//send current moisture value
}

////////////////////////////////////////////////////////////////////////////////
//////////////////////// Set Up ////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
void setup() 
{
  Serial.begin(9600);
  delay(500);
  delay(1000);

  //Pin Modes
  pinMode(soilPower, OUTPUT);//Set D7 as an OUTPUT
  digitalWrite(soilPower, LOW);

}


////////////////////////////////////////////////////////////////////////////////
////////////////////////  Loop  ////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void loop() {

  ///////////////////////  Reads Pins  //////////////////////////////////////////
  //Takes 5 measurements from the sensor to be averaged out
  for (int i = 0; i < 5; i++)
  {
    DHT.read11(dht_apin);
    dht_temp += DHT.temperature;
    dht_humidity += DHT.humidity;
    delay(2500);  
  }
  dht_temp = dht_temp/5; dht_humidity = dht_humidity/5;
  light = analogRead(light_pin);



  ////////////////////// Prints to Serial ///////////////////////////////////////
  Serial.print("Humidity = ");
  Serial.print(dht_humidity);
  Serial.print("%\t");
  Serial.print("Temperature = ");
  Serial.print(dht_temp);
  Serial.print(" C\t");
  Serial.print("Soil Moisture = ");
  Serial.print(readSoil());
  Serial.print(" \t");
  Serial.print("Light = ");
  Serial.print(light);
  Serial.print(" \n") ;
}
